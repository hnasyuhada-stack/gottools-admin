<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GotTools Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
  html{visibility:hidden;}
  html, body { margin:0; padding:0; } /* ✅ no background here */
  body { opacity:0; }
  body.fade-in { opacity:1; transition: opacity .25s ease-in; }
     .chart-wrap{ position:relative; height:260px; width:100%; }
    .chart-wrap canvas{ width:100% !important; height:100% !important; }
  </style>

  <!-- keep: prevents blank page -->
  <script>
    document.documentElement.style.visibility = "visible";
  </script>

  <link rel="stylesheet" href="css/dashboard.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

</head>

<body>

<div class="layout">

  <aside class="sidebar">
    <div class="sidebar-top">
      <div class="brand">
        <div class="brand-mark">
          <img src="img/logo.png" alt="GotTools Logo">
        </div>
        <div class="brand-text">
          <h1>GotTools? Admin</h1>
        </div>
      </div>

      <div class="sidebar-mini">
        <div class="mini-row">
          <div class="mini-avatar" style="background-image:url('img/profile.png');"></div>
          <div class="mini-info">
            <strong id="adminNameTop">Admin</strong>
            <span id="adminRoleTop">Admin</span>
          </div>
        </div>
      </div>
    </div>

    <nav class="sidebar-nav" aria-label="Sidebar Navigation">
      <a href="dashboard.html" class="sidebar-link active">
        <img class="nav-ico" src="img/icons/nav-dashboard.png" alt="">
        <span>Dashboard</span>
      </a>

      <a href="reports.html" class="sidebar-link">
        <img class="nav-ico" src="img/icons/nav-reports.png" alt="">
        <span>Reports</span>
      </a>

      <a href="users.html" class="sidebar-link">
        <img class="nav-ico" src="img/icons/nav-users.png" alt="">
        <span>Users</span>
      </a>

      <a href="tools.html" class="sidebar-link">
        <img class="nav-ico" src="img/icons/nav-tools.png" alt="">
        <span>Tools / Listings</span>
      </a>

      <a href="settings.html" class="sidebar-link">
        <img class="nav-ico" src="img/icons/nav-settings.png" alt="">
        <span>Settings</span>
      </a>

      <div class="sidebar-divider"></div>

      <a href="#" class="sidebar-link danger" id="btnLogout">
        <img class="nav-ico" src="img/icons/nav-logout.png" alt="">
        <span>Log Out</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <p>GotTools? Admin Panel</p>
    </div>
  </aside>

  <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

  <main class="main">

    <header class="topbar">
      <div class="topbar-left">
        <button class="hamburger-btn" onclick="toggleSidebar()" aria-label="Open sidebar">
          <img src="img/icons/nav-menu.png" alt="">
        </button>

        <div class="topbar-title">
          <p class="welcome">Welcome back, <span class="highlight" id="adminWelcomeName">Admin</span></p>
          <h2>Admin Dashboard</h2>
        </div>
      </div>

      <div class="topbar-right">

        <div class="search-container">
          <img class="search-ico" src="img/icons/nav-search.png" alt="">
          <input type="text" id="adminSearch" placeholder="Search users, listings, reports..." />
          <button class="clear-btn" type="button" onclick="adminSearch.value=''">
            <img src="img/icons/nav-close.png" alt="">
          </button>
        </div>
      </div>
    </header>

    <section class="metric-grid" style="margin-top:16px;">
      <article class="metric-card">
        <div class="metric-head">
          <p class="metric-title">Total Active Users</p>
          <span class="metric-chip">Community</span>
        </div>
        <p class="metric-value" id="mTotalUsers">0</p>
        <p class="metric-sub">Active accounts in community</p>
      </article>

      <article class="metric-card">
        <div class="metric-head">
<p class="metric-title">Total Listings</p>
<span class="metric-chip">Rental</span>
        </div>
        <p class="metric-value" id="mTotalListings">0</p>
<p class="metric-sub">Active rental listings</p>
      </article>

<article class="metric-card">
  <div class="metric-head">
    <p class="metric-title">Reports In Review</p>
    <span class="metric-chip">Activity</span>
  </div>

  <!-- big number -->
  <p class="metric-value" id="mReportsInReview">0</p>

  <!-- small helper text -->
  <p class="metric-sub">Cases currently being reviewed</p>
</article>



      <article class="metric-card warn">
        <div class="metric-head">
          <p class="metric-title">Report Pending</p>
          <span class="metric-chip danger">Needs action</span>
        </div>
        <p class="metric-value" id="mPendingReports">0</p>
        <p class="metric-sub">Cases awaiting action</p>
      </article>
    </section>

    <section class="content-row" style="margin-top:16px;">
      <article class="card chart-card">
        <div class="card-header">
          <div>
            <h3>Weekly Bookings</h3>
            <small>Borrow / Rent activity trend</small>
          </div>
          <span class="card-pill">7 days</span>
        </div>
        <div class="chart-wrap">
          <canvas id="chartWeeklyBookings"></canvas>
        </div>
      </article>

<article class="card chart-card">
  <div class="card-header">
    <div>
      <h3>Cases Inflow</h3>
      <small>New reports & disputes (last 7 days)</small>
    </div>
    <span class="card-pill">7 days</span>
  </div>
  <div class="chart-wrap">
    <canvas id="chartCasesInflow"></canvas>
  </div>
</article>

    </section>

    <section class="content-row" style="margin-top:16px;">
  <article class="card chart-card">
  <div class="card-header">
    <div>
      <h3>Cases by Status</h3>
      <small>Pending · In Review · Resolved · Overdue</small>
    </div>
    <span class="card-pill">Queue</span>
  </div>
  <div class="chart-wrap">
    <canvas id="chartCasesByStatus"></canvas>
  </div>
</article>


<article class="card chart-card">
  <div class="card-header">
    <div>
      <h3>Dispute Outcomes</h3>
      <small>Deposit decisions summary</small>
    </div>
    <span class="card-pill">Deposits</span>
  </div>
  <div class="chart-wrap">
    <canvas id="chartDisputeOutcomes"></canvas>
  </div>
</article>


    </section>

    <section class="table-grid" style="margin-top:16px;">

      <article class="card">
        <div class="card-header">
          <div>
            <h3>Recent Damage & Dispute Reports</h3>
            <small>Latest cases in the system</small>
          </div>
          <button class="btn" type="button" onclick="window.location.href='reports.html'">View all</button>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>User</th>
                <th>Tool</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="recentReportsTbody">
              <tr><td colspan="6">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </article>

      <article class="card">
        <div class="card-header">
          <div>
            <h3>Latest Users</h3>
            <small>New registrations</small>
          </div>
          <button class="btn" type="button" onclick="window.location.href='users.html'">Manage users</button>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>User</th>
                <th>Joined</th>
                <th>Transactions</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="latestUsersTbody">
              <tr><td colspan="5">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </article>

    </section>

  </main>
</div>

<script>
  function toggleSidebar() {
    document.querySelector(".sidebar").classList.toggle("show");
    document.querySelector(".sidebar-overlay").classList.toggle("active");
  }

  document.addEventListener("DOMContentLoaded", () => {
    const notifBtn = document.querySelector(".notification");
    const notifPanel = document.getElementById("notificationPanel");

    if (notifBtn && notifPanel) {
      notifBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        notifPanel.style.display =
          notifPanel.style.display === "block" ? "none" : "block";
      });

      document.addEventListener("click", (e) => {
        if (!notifPanel.contains(e.target) && !notifBtn.contains(e.target)) {
          notifPanel.style.display = "none";
        }
      });
    }

    const currentPage = location.pathname.split("/").pop().split("?")[0];
    document.querySelectorAll(".sidebar-link").forEach(link => {
      if (link.getAttribute("href") === currentPage) link.classList.add("active");
    });
  });

  // ❌ DO NOT fade-in here anymore (controller will fade-in after guard success)
</script>

<!-- ✅ Controller MUST load first -->
<script type="module" src="./js/dashboard-page.js"></script>

<!-- ✅ Dashboard data logic -->
<script type="module" src="./js/dashboard.js"></script>

</body>
</html>
